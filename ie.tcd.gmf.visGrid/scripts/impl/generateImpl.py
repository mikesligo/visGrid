import sys 
import re
import shutil

if (len(sys.argv) <2):
    sys.exit(0)

r = open(sys.argv[1],'r')
w = open(sys.argv[1]+'.swp','w')

line = r.readline()
while line:
    print line
    if 'public class ' in line:
        w.write(line)
        w.write('\t\tboolean lock = false;\n')

    else: 
        search = re.search('String get(\w+)\(\) \{', line)
        if search is not None:
            w.write(line)
            search = None
            while (search is None):
                search = re.search('return (\w+);',line)
                line = r.readline()
            key = search.group(1)
            print 'Adding http get for '+key
            w.write('\t\t// Generated by python script located in this directory\n')
            w.write('\t\tif (!lock){\n')
            w.write('\t\t\ttry {\n')
            if '__' in key:
                w.write('\t\t\t\tif (val == null) val = http.Property.getValueOfProperty(this.getName(),"'+(key[0:1].lower()+key[1:]).replace("__","%20")+'");\n')
                w.write('\t\t\t\tif (val == null) val = http.Property.getValueOfProperty(this.getName(),"'+(key.upper()).replace("__","%20")+'");\n')
            else:
                w.write('\t\t\t\tString val = http.Property.getValueOfProperty(this.getName(),"'+key[0:1].lower()+key[1:]+'");\n');
                w.write('\t\t\t\tif (val == null) val = http.Property.getValueOfProperty(this.getName(),"'+key[0:1].upper()+key[1:]+'");\n')
            w.write('\t\t\t\t'+key[0:1].lower()+key[1:]+'= val;\n');
            w.write('\t\t\t} catch (Exception e) {\n\t\t\t\tthis.set'+key+'("unknown");\n\t\t\t\te.printStackTrace();\n\t\t\t}\n')
            w.write('\t\t}\n')
            w.write(line)
        else: w.write(line)

    line = r.readline()

r.close()
w.close()
#shutil.move(sys.argv[1]+'.swp',sys.argv[1])
